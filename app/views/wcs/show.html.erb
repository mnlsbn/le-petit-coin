<div class="form">
  <div class = 'col-xs-12 col-md-6'>
  <%= cl_image_tag ('wc_icon_ipzyxq'), height: 100 %>
  </div>
</div>

<div class="media">
  <div class="media-body">
    <div class="media-section">
      <h2><%= @wc.name%></h2>

<!-- Card à finaliser -->
 <div class="container">
   <div class="row">
     <% wcs.each do |user, wc| %>
       <div class="col-xs-12 col-sm-4">
         <% if @wc.photo? %>
           <%= cl_image_tag @wc.photo.path, width: 200, height: 300, crop: :fill %>
         <% end %>
           <div class="card-category"><%= @wc.address %></div>
           <div class="card-description">
             <h2><%= @wc.name %></h2>
             <p><%= @wc.description %></p>
           </div>
           <% if @profile.photo? %>
             <%= cl_image_tag @profile.photo.path, class:"card-user avatar avatar-large" %>
           <% end %>
           <%= link_to "Details", wc_path(wc), class: "card-link" %>
         </div>
       </div>
     <% end %>
   </div>
 </div>

<!-- Card à finaliser -->

        <div class="form">
          <div class = 'col-xs-12 col-md-6'>
            <% if @wc.photo? %>
              <%= cl_image_tag @wc.photo.path, width: 200, height: 300, crop: :fill %>
            <% end %>
            <h1><%= @wc.name %></h1>
            <h3><em><%= 'Le Petit Coin de ' + Profile.where(user_id: @wc.user_id).first.first_name.capitalize %></em></h3>
            <p><strong>Description :</strong></p>
            <%= @wc.description.capitalize %>
            <p></p>
            <p><strong>Addresse: </strong></p>
            <%=  @wc.address%>
            <p></p>
            <p><strong>Available ? </strong></p>
            <%=  @wc.availability == true ? 'Yes' : 'No, sorry' %>
            <p></p>
            <%= render partial: 'bookings/form', locals: { booking: Booking.new, wc: @wc } %>
            <p><%= link_to 'Back to the list', wcs_path %></p>
          </div>
        </div>

    </div>
  </div>


  <div class="media-aside">
     <div class="media-section">
       <h2>Location</h2>
        <div id="map" style="width: 100%; height: 600px;"></div>

       <% content_for(:after_js) do %>
         <%= javascript_tag do %>
           $(document).ready(function() {
             var handler = Gmaps.build('Google');
             handler.buildMap({ internal: { id: 'map' } }, function() {
               markers = handler.addMarkers(<%= raw @hash.to_json %>);
               handler.bounds.extendWith(markers);
               handler.fitMapToBounds();
               if (markers.length == 0) {
                 handler.getMap().setZoom(2);
               } else if (markers.length == 1) {
                 handler.getMap().setZoom(14);
               }
             });
           });
         <% end %>
       <% end %>

     </div>
   </div>
</div>

<div class="reviews">
  <%= @wc.reviews.each do |review| %>
    <%= 'Posted by ' + Profile.where(user_id: Booking.find(review.booking_id).user_id).first.first_name.capitalize + review.description %>
    <%= review.rating %>
    <%= review.description %>
  <% end %>
</div>
<% if current_user %>
  <div class="form">
    <% if current_user.bookings.pluck(:wc_id).include? @wc.id %>
      <% Booking.where(wc_id: @wc.id, user: current_user).each do |booking| %>
        <div class="add-review" style="border:1px solid;">

        <p><%= 'You have had the chance to use ' + Profile.where(user_id: @wc.user_id).first.first_name.capitalize + "'s Petit Coin" + ' on ' + booking.created_at.to_s %></p>
        <% if booking.reviews.empty? %>
          <p>Let others know what you thought of it: </p>
          <%= render partial: 'reviews/form', locals: {booking: booking, review: Review.new } %>
          </div>
        <% end %>
      <% end %>
    <% end %>
  </div>
<% end %>
